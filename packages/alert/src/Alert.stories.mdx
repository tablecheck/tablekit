import { Meta, Story, Canvas, Props } from '@storybook/addon-docs/blocks';
import { useState } from 'react';
import { v4 as uuid } from 'uuid';
import { ZIndex } from '@tablecheck/tablekit-theme';
import { Button } from '../../button';
import { ItemGroup } from '../../item';
import { Select } from '../../select';
import { Alert, AlertAppearance } from './index';

export const positionOptions = [
  {
    label: 'Top left',
    value: 'top-left'
  },
  {
    label: 'Top center',
    value: 'top'
  },
  {
    label: 'Top right',
    value: 'top-right'
  },
  {
    label: 'Bottom left',
    value: 'bottom-left'
  },
  {
    label: 'Bottom center',
    value: 'bottom'
  },
  {
    label: 'Bottom right',
    value: 'bottom-right'
  },
  {
    label: 'All',
    value: 'all'
  }
];

<Meta
  title="Components/Alert"
  component={Alert}
  parameters={{ options: { isToolshown: true } }}
/>

export const Template = ({ label, message, hasActions, ...alertProps }) => {
  const [isAlertVisible, setAlertVisible] = useState(false);
  return (
    <>
      <Button
        appearance="primary"
        onClick={() => {
          setAlertVisible(true);
        }}
      >
        Show {label}
      </Button>
      <Alert
        {...alertProps}
        onClose={() => setAlertVisible(false)}
        isShow={isAlertVisible}
        isDismissible
        shouldUsePortal
        actions={
          hasActions
            ? [
                {
                  text: 'More info...'
                },
                {
                  text: 'Close',
                  onClick: () => {
                    setAlertVisible(false);
                  }
                }
              ]
            : undefined
        }
      >
        {message || `Message for ${label}`}
      </Alert>
    </>
  );
};

export const TemplatePositions = ({
  label,
  message,
  hasActions,
  ...alertProps
}) => {
  const [isShow, setIsShow] = useState(false);
  const [alerts, setAlerts] = useState([]);
  const [position, setPosition] = useState(positionOptions[0].value);
  const getAlertData = (index) => {
    const id = uuid();
    return {
      text: `Message ${index + 1}`,
      appearance: 'success',
      onClose: () => {
        setAlerts((curAlerts) => {
          const newArray = [...curAlerts];
          newArray.splice(-(index + 1), 1);
          return newArray;
        });
      },
      key: id
    };
  };
  return (
    <ItemGroup hasIndent>
      <ItemGroup hasIndent title="Initial position for Alert">
        <Select
          options={positionOptions}
          value={positionOptions.find(({ value }) => value === position)}
          menuPortalTarget={document.body}
          onChange={({ value }) => setPosition(value)}
          styles={{
            menuPortal: (base) => ({ ...base, zIndex: ZIndex.Modal })
          }}
        />
        <ItemGroup orientation="horizontal" hasIndent>
          <Button
            appearance="primary"
            onClick={() => {
              setIsShow(!isShow);
              if (alerts.length === 0) {
                setAlerts([getAlertData(alerts.length), ...alerts]);
              } else {
                setAlerts([]);
              }
            }}
          >
            {isShow ? 'Reset All' : 'Show Alert!'}
          </Button>
          <Button
            appearance="primary"
            isDisabled={!isShow}
            onClick={() => {
              setAlerts([getAlertData(alerts.length), ...alerts]);
            }}
          >
            Generate new Alert
          </Button>
        </ItemGroup>
      </ItemGroup>
      {position === 'all'
        ? positionOptions.map(({ value }) => {
            if (value !== 'all') {
              return alerts.map(({ key, text, ...alertProp }) => (
                <Alert
                  key={key}
                  {...alertProp}
                  isShow={isShow}
                  position={value}
                  isDismissible
                  shouldUsePortal
                >
                  {text}
                </Alert>
              ));
            }
          })
        : alerts.map(({ key, text, ...alertProp }) => (
            <Alert
              key={key}
              {...alertProp}
              isShow={isShow}
              position={position}
              isDismissible
              shouldUsePortal
            >
              {text}
            </Alert>
          ))}
    </ItemGroup>
  );
};

# Alert

The Alert component is used to display messages (usually errors or notifications) in a small modal dialog.

## Appearances

Four main appearances are presented by default:

- primary (info)
- success
- warning
- danger

<Canvas>
  <Story
    name="success"
    args={{ label: 'success', appearance: AlertAppearance.Success }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="danger"
    args={{ label: 'danger', appearance: AlertAppearance.Danger }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="warning"
    args={{ label: 'warning', appearance: AlertAppearance.Warning }}
  >
    {Template.bind({})}
  </Story>
  <Story
    name="primary"
    args={{ label: 'primary', appearance: AlertAppearance.Primary }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Actions

Alerts can have buttons (like CTAs) displayed in the footer using the `actions` prop.

<Canvas>
  <Story
    name="actions"
    args={{
      label: 'alert with actions',
      message:
        'This content must exceed the maximum permissible width for this notification and span multiple lines.',
      appearance: AlertAppearance.Success,
      hasActions: true
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Positions

Alerts be displayed in different positions on the screen

<Canvas>
  <Story
    name="positions"
    args={{
      label: 'positioned alert',
      appearance: AlertAppearance.Success
    }}
  >
    {TemplatePositions.bind({})}
  </Story>
</Canvas>

## Custom content

In the scenario that the content needs to be different, the icon can be hidden

<Canvas>
  <Story
    name="custom-content"
    args={{
      label: 'custom content',
      shouldHideIcon: true,
      message: (
        <>
          <h3>Content heading</h3>
          <List>
            <li>First item</li>
            <li>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. In nec
              risus a libero dictum aliquam maximus tincidunt nisi. Aliquam
              metus tellus
            </li>
          </List>
        </>
      ),
      appearance: AlertAppearance.Primary
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Props

<Props of={Alert} />
